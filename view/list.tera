<!DOCTYPE html>
<html>
  <head>
    <title>Forum</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
    <link rel="stylesheet" href="../css/mdc.min.css">
    <script src="../js/mdc.min.js"></script>
    <script>window.mdc.autoInit();</script>
    <style type="text/css">
       #container {
        padding:70px 50px;
        font: 15px "Lucida Grande", Helvetica, Arial, sans-serif;
      }
      #title {
        color: white;
      }
      a {
        color: #00B7FF;
        text-decoration:none; 
      }
      .add{
        margin-top: 16px;
        padding-top: 16px;
        border-top: 1px dashed #333;
      }
    </style>
  </head>
  <body>
   <header class="mdc-toolbar mdc-toolbar--fixed" id="header">
        <div class="mdc-toolbar__row">
            <section class="mdc-toolbar__section mdc-toolbar__section--align-start">
              <a href="/" id="title" class="mdc-toolbar__title"><strong>Forum</strong></a>
            </section>
            <div class="user">
              {% if username %}
              <section class="mdc-toolbar__section mdc-toolbar__section--shrink-to-fit">
                欢迎您:{{ username }}&emsp;
              </section>
              <section class="mdc-toolbar__section mdc-toolbar__section--shrink-to-fit">
                <a href="/user/logout">注销</a>&emsp;&emsp;
              </section>
              {% else %}
              <section class="mdc-toolbar__section mdc-toolbar__section--shrink-to-fit">
                <a href="/user/register" title="我要注册" class="mdc-toolbar__title">注册</a>
              </section>
              <section class="mdc-toolbar__section mdc-toolbar__section--align-end">
                <a href="/user/login" title="去登录" class="mdc-toolbar__title">登录</a> &emsp;&emsp;
              </section>
              {% endif %}
            </div>
        </div>
   </header>
   <div id="container">
    <h2>详情</h2>
    <p>标题： {{ toptic.title }}</p> 
    <div>{{ toptic.content }}</div>
    <div class="reply">
    <h2>评论</h2>
    <div class="reply_con">
      <table>
        {% for reply in replys %}
          <tr>
            <td>{{loop.index}}.</td>
            <td>{{ reply.content }}</td>
            <td>{{ reply.createtime }}</td>
          </tr>
        {% endfor %}
      </table>
    </div>
  </div>
  <div class="answer">
  {% if username %}
    <textarea class="ans_con" cols="100" rows="10"></textarea><br>
    <button type="submit" id="submit" data-pid="{{ toptic.id }}" class="mdc-button" style="background-color:aqua"><span class="tip"> 回复 </span></button>
    <script type="text/javascript" src="http://mat1.gtimg.com/libs/jquery/1.12.0/jquery.min.js"></script>
    <script type="text/javascript" >
      var running = false;
      $('#submit').on('click', function(){
        if(running) return;
        running = true;
        $('.tip').text('');

        var ans_con = $('.ans_con').val();
        if(!ans_con){
          $('.tip').text('*输入不能为空');
          return;
        }
        $('.tip').text('数据正在提交中...');
        
        var pid = $(this).data('pid');

        $.ajax({
          async: false,
          url : '/list/addreply',
          data : {pid:pid, content:ans_con},
          dataType : 'json',
          type : 'get'
        }).done(function(){
          
          running = false;
        })
        window.location.reload ( true );  
      })
    </script>
  {% else %}
    <span style="background-color:aqua">请登录后回复.<a href="/user/login">去登录</a></span>
  {% endif %}
  </div>
</body>
</html>